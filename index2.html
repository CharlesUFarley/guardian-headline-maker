<!DOCTYPE html>
<html lang="en">

<head>
    <title>Grauniad Headline Generator</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="resources/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="resources/v2.6.css?v1">

    <script type="text/javascript" src="resources/html2canvas.min.js"></script>    
    <script type="text/javascript" src="resources/FileSaver.204.js"></script>
    <script type="text/javascript" src="resources/lity_p.js"></script>
    <!-- 
        you can remove the images line below to load the page MUCH faster at the cost of loading images 
        on request however this WILL BREAK images when using TOR or content parsing proxies
    -->
    <script type="text/javascript" src="images/mugshots/images.js?v1.2"></script>
</head>

<body>
    <div class="content">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-12">

                    <!--
					<div class="alert alert-warning center-text alert-dismissible">
						<a href="#" id="close" class="close" data-dismiss="alert" aria-label="close">&times;</a>
						<strong></strong>
					</div>
                    -->

                    <noscript>
                        <div class="alert alert-warning center-text alert-dismissible">
                            <a href="#" id="close" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            <strong>If you can read this then the site is being broken by whatever site you're using to browse it or you have javascript off, either way there isn't much that we can do to fix it.</strong>
                        </div>
                    </noscript>

                    <div class="alert alert-warning center-text alert-dismissible ie_warning" id="ie_warning">
                        <a href="#" id="close" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>This site does not support Internet Explorer due to a lack of the necessary features required.  Install a real browser</strong>
                    </div>                    

                    <!-- meme-bg-target -->
                    <div class="non-sticky">

                        <div class="loader" id="loader" name="loader">
                            <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                            width="80px" height="80px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">
                                <path fill="#000" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z">
                                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"/>
                                </path>
                            </svg>
                        </div>
                        
                        <div id="meme-bg-target" name="meme-bg-target" >
                            <div class="wrap">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-12">
                                        <div class="top-container">
                                            <div class="top-element">
                                                <div id="menu">
                                                    <div class="meme-menu-news"></div>
                                                    <div class="meme-menu-opinion"></div>
                                                    <div class="meme-menu-sport"></div>
                                                    <div class="meme-menu-culture"></div>
                                                    <div class="meme-menu-lifestyle"></div>
                                                </div>                                                    
                                                <div class="meme-sub-area" id="meme-sub-area"></div>
                                                <div class="meme-title-area-place">
                                                    <div class="meme-title-area"  id="meme-title-area" placeholder="Opinion" contenteditable="true" spellcheck="false">Opinion</div>
                                                </div>
                                                <div class="meme-text-area-place">
                                                    <div class="meme-txt-area">
                                                        <div placeholder="Click here to type your meme" contenteditable="true" spellcheck="false" id="meme-txt-area"></div>
                                                    </div>
                                                    <div class="meme-name-area" id="meme-name-area">Owen Jones</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12 col-sm-12">
                                    <div class="bottom-container">
                                        <div class="bottom-element">
                                            <div>
                                                <div class="meme-byline-area">
                                                    <div placeholder="Don't forget that you have two lines here as well so make sure that you edit them or your headline will look pants" contenteditable="true" spellcheck="false" id="meme-byline-area"></div>
                                                </div>
                                            </div>
                                            <div class="meme-date-area" id="meme-date-area"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="photo">
                                <img id="photo" src="" crossOrigin="anonymous">
                            </div>
                        </div>
                        <!-- End meme-bg-target -->
                    
                        <div class="row">
                            <div class="col-xs-12 col-sm-12 col-md-10 btn-group btn-group-md">
                                <button type="button" name="save-as-image" id="save-as-image" class="btn btn-primary">Download Meme</button>
                                <!-- copy to clipboard only works over HTTPS and only with Chrome browsers! -->
                                <button type="button" name="copy-to-clipboard" id="copy-to-clipboard" class="btn btn-primary">Copy to Clipboard</button>
                                <p id="savemessage" class="h4"></p>
                            </div>
                        </div>
                    </div>

                   <!-- meme-control -->
                   <div class="row text-center">
                    <div class="col-xs-12 col-sm-12 col-md-10">
                        <!-- Names row -->
                        <div class="btn-group btn-group-md">
                            <p class="h4">Guardian Hacks</p>
                            <button type="button" class="btn btn-primary name"           value="owenjones" overrideName="Owen Jones">The Boy Jones</button>
                            <button type="button" class="btn btn-primary name"           value="abiwilkinson">Abi Wilkinson</button>
                            <button type="button" class="btn btn-primary name name-pink" value="adrianchiles">Adrian Chiles</button>
                            <button type="button" class="btn btn-primary name"           value="afuahirsch">Afua Hirsch</button>
                            <button type="button" class="btn btn-primary name"           value="arwamahdawi">Arwa Mahdawi</button>
                            <button type="button" class="btn btn-primary name"           value="barbaraspeed">Barbara Speed</button>
                            <button type="button" class="btn btn-primary name"           value="catherinebennett">Catherine Bennett</button>
                            <button type="button" class="btn btn-primary name"           value="carolecadwalladr">Carole Cadwalladr</button>
                            <button type="button" class="btn btn-primary name"           value="carolinecriadoperez">Caroline Criado-Perez</button>
                            <button type="button" class="btn btn-primary name"           value="davidmitchell">David Mitchell</button>
                            <button type="button" class="btn btn-primary name name-pink" value="">Editorial</button>
                            <button type="button" class="btn btn-primary name"           value="faizashaheen">Faiza Shaheen</button>
                            <button type="button" class="btn btn-primary name"           value="gabyhinsliff">Gaby Hinsliff</button>
                            <button type="button" class="btn btn-primary name"           value="georgemonbiot" numImages=4>George Monbiot</button>
                            <button type="button" class="btn btn-primary name"           value="hadleyfreeman">Hadley Freeman</button>
                            <button type="button" class="btn btn-primary name"           value="hannahjaneparkinson">Hannah Jane Parkinson</button>
                            <button type="button" class="btn btn-primary name"           value="jessicavalenti">Jessica Valenti</button>
                            <button type="button" class="btn btn-primary name"           value="jonathanfreedland">Jonathan Freedland</button>
                            <button type="button" class="btn btn-primary name"           value="katharineviner">Katharine Viner</button>
                            <button type="button" class="btn btn-primary name name-pink" value="kehindeandrews">Kehinde Andrews</button>
                            <button type="button" class="btn btn-primary name"           value="marinahyde" numImages=2>Marina Hyde</button>
                            <button type="button" class="btn btn-primary name"           value="martinkettle">Martin Kettle</button>
                            <button type="button" class="btn btn-primary name"           value="martinrowson">Martin Rowson</button>
                            <button type="button" class="btn btn-primary name"           value="mehdihasan">Mehdi Hasan</button>
                            <button type="button" class="btn btn-primary name"           value="monaeltahawy">Mona Eltahawy</button>
                            <button type="button" class="btn btn-primary name"           value="nesrinemalik">Nesrine Malik</button>
                            <button type="button" class="btn btn-primary name"           value="paulmason">Paul Mason</button>
                            <button type="button" class="btn btn-primary name"           value="pollytoynbee">Polly Toynbee</button>
                            <button type="button" class="btn btn-primary name"           value="rafaelbehr">Rafael Behr</button>
                            <button type="button" class="btn btn-primary name"           value="rhiannonlucycosslett">Rhiannon Lucy Cosslett</button>
                            <button type="button" class="btn btn-primary name"           value="simonjenkins">Simon Jenkins</button>
                            <button type="button" class="btn btn-primary name"           value="vanbadham">Van Badham</button>
                            <button type="button" class="btn btn-primary name"           value="willhutton">Will Hutton</button>
                            <button type="button" class="btn btn-primary name"           value="willself">Will Self</button>
                            <button type="button" class="btn btn-primary name"           value="yasminalibhaibrown">Yasmin Alibhai-Brown</button>
                            <button type="button" class="btn btn-primary name"           value="zoewilliams">Zoe Williams</button>
                        </div>

                        <div class="btn-group btn-group-md">
                            <p class="h4">Brexit Crybabies</p>
                            <button type="button" class="btn btn-primary name"           value="acgrayling">AC Grayling</button>
                            <button type="button" class="btn btn-primary name"           value="annasoubry">Anna Soubry</button>
                            <button type="button" class="btn btn-primary name"           value="femioluwole">Femi Oluwole</button>
                            <button type="button" class="btn btn-primary name"           value="garylineker">Gary Lineker</button>
                            <button type="button" class="btn btn-primary name"           value="ginamiller">Gina Miller</button>
                            <button type="button" class="btn btn-primary name"           value="humzayousef">Humza Yousef</button>
                            <button type="button" class="btn btn-primary name"           value="ianblackford">Ian Blackford</button>
                            <button type="button" class="btn btn-primary name"           value="jamesobrien">James O'Brien</button>
                            <button type="button" class="btn btn-primary name"           value="jolyonmaugham">Jolyon Maugham</button>
                            <button type="button" class="btn btn-primary name name-pink" value="lizwebster">Liz Webster</button>
                            <button type="button" class="btn btn-primary name"           value="nicolasturgeon">Nicola Sturgeon</button>
                            <button type="button" class="btn btn-primary name"           value="nishkumar">Nish Kumar</button>
                            <button type="button" class="btn btn-primary name"           value="shelaghfogarty">Shelagh Fogarty</button>
                            <button type="button" class="btn btn-primary name"           value="stevebray">Steve Bray</button>
                            <button type="button" class="btn btn-primary name"           value="ursulavonderleyen">Ursula von der Leyen</button>
                        </div>

                        <div class="btn-group btn-group-md">
                            <p class="h4">Labour and its seething left</p>
                            <button type="button" class="btn btn-primary name"           value="alastaircampbell">Alastair Campbell</button>
                            <button type="button" class="btn btn-primary name"           value="andrewadonis">Andrew Adonis</button>
                            <button type="button" class="btn btn-primary name"           value="andyburnham">Andy Burnham</button>
                            <button type="button" class="btn btn-primary name"           value="anneliesedodds">Anneliese Dodds</button>
                            <button type="button" class="btn btn-primary name"           value="angelarayner">Angela Rayner</button>
                            <button type="button" class="btn btn-primary name"           value="apsanabegum">Apsana Begum</button>
                            <button type="button" class="btn btn-primary name"           value="barrygardiner">Barry Gardiner</button>
                            <button type="button" class="btn btn-primary name"           value="bellribeiroaddy">Bell Ribeiro-Addy</button>
                            <button type="button" class="btn btn-primary name"           value="bridgetphillipson">Bridget Phillipson</button>
                            <button type="button" class="btn btn-primary name"           value="chriswilliamson">Chris Williamson</button>
                            <button type="button" class="btn btn-primary name"           value="davidlammy">David Lammy</button>
                            <button type="button" class="btn btn-primary name"           value="dawnbutler">Dawn Butler</button>
                            <button type="button" class="btn btn-primary name"           value="dianeabbott">Diane Abbott</button>
                            <button type="button" class="btn btn-primary name"           value="eddieizzard">Eddie Izzard</button>
                            <button type="button" class="btn btn-primary name"           value="emilythornberry">Emily Thornberry</button>
                            <button type="button" class="btn btn-primary name"           value="georgegalloway">George Galloway</button>
                            <button type="button" class="btn btn-primary name"           value="jaredomara">Jared O'Mara</button>
                            <button type="button" class="btn btn-primary name"           value="jeremycorbyn">Jeremy Corbyn</button>
                            <button type="button" class="btn btn-primary name"           value="jessphillips">Jess Phillips</button>
                            <button type="button" class="btn btn-primary name"           value="johnmcdonnell">John McDonnell</button>
                            <button type="button" class="btn btn-primary name"           value="kenlivingstone">Ken Livingstone</button>
                            <button type="button" class="btn btn-primary name"           value="keirstarmer">Keir Starmer</button>
                            <button type="button" class="btn btn-primary name"           value="lisanandy">Lisa Nandy</button>
                            <button type="button" class="btn btn-primary name"           value="lloydrussellmoyle">Lloyd Russell-Moyle</button>
                            <button type="button" class="btn btn-primary name"           value="nazshah">Naz Shah</button>
                            <button type="button" class="btn btn-primary name"           value="patmcfadden">Pat McFadden</button>
                            <button type="button" class="btn btn-primary name"           value="rachelreeves">Rachel Reeves</button>
                            <button type="button" class="btn btn-primary name"           value="rebeccalongbailey">Rebecca Long-Bailey</button>
                            <button type="button" class="btn btn-primary name"           value="richardburgon">Richard Burgon</button>
                            <button type="button" class="btn btn-primary name"           value="seumasmilne">Seumas Milne</button>
                            <button type="button" class="btn btn-primary name"           value="shabanamahmood">Shabana Mahmood</button>
                            <button type="button" class="btn btn-primary name"           value="shamichakrabarti">Shami Chakrabarti</button>
                            <button type="button" class="btn btn-primary name"           value="stellacreasy">Stella Creasy</button>
                            <button type="button" class="btn btn-primary name"           value="sadiqkhan">Sadiq Khan</button>
                            <button type="button" class="btn btn-primary name"           value="yvettecooper">Yvette Cooper</button>
                            <button type="button" class="btn btn-primary name"           value="zarahsultana">Zarah Sultana</button>
                        </div>

                        <div class="btn-group btn-group-md">
                            <p class="h4">The Dregs</p>
                            <button type="button" class="btn btn-primary name name-pink" value="adjoaandoh">Adjoa Andoh</button>
                            <button type="button" class="btn btn-primary name"           value="alexandriaocasiocortez">Alexandria Ocasio-Cortez</button>
                            <button type="button" class="btn btn-primary name"           value="ashsarkar">Ash Sarkar</button>
                            <button type="button" class="btn btn-primary name"           value="bethrigby">Beth Rigby</button>
                            <button type="button" class="btn btn-primary name name-pink" value="billybragg">Billy Bragg</button>
                            <button type="button" class="btn btn-primary name"           value="bono">Bono</button>
                            <button type="button" class="btn btn-primary name"           value="carolinelucas">Caroline Lucas</button>
                            <button type="button" class="btn btn-primary name name-pink" value="carolvorderman">Carol Vorderman</button>
                            <button type="button" class="btn btn-primary name name-pink" value="charlotteproudman">Charlotte Proudman</button>
                            <button type="button" class="btn btn-primary name"           value="clementineford">Clementine Ford</button>
                            <button type="button" class="btn btn-primary name name-pink" value="danielanadj">Daniela Nadj</button>
                            <button type="button" class="btn btn-primary name"           value="donlemon">Don Lemon</button>
                            <button type="button" class="btn btn-primary name"           value="gerryadams">Gerry Adams</button>
                            <button type="button" class="btn btn-primary name"           value="gretathunberg">Greta Thunberg</button>
                            <button type="button" class="btn btn-primary name name-pink" value="huwedwards">Huw Edwards</button>
                            <button type="button" class="btn btn-primary name"           value="indiawilloughby">India Willoughby</button>
                            <button type="button" class="btn btn-primary name"           value="jackmonroe">Jack Monroe</button>
                            <button type="button" class="btn btn-primary name name-pink" value="juliapatterson">Dr Julia Grace Patterson</button>
                            <button type="button" class="btn btn-primary name"           value="justinwelby">Justin Welby</button>
                            <button type="button" class="btn btn-primary name name-pink" value="kikeojothompson">Kike Ojo-Thompson</button>
			    <button type="button" class="btn btn-primary name"           value="lauriepenny">Laurie Penny</button>
                            <button type="button" class="btn btn-primary name"           value="lenmccluskey">Len McCluskey</button>
                            <button type="button" class="btn btn-primary name"           value="lilyallen">Lily Allen</button>
                            <button type="button" class="btn btn-primary name"           value="lindasarsour">Linda Sarsour</button>
							<button type="button" class="btn btn-primary name name-pink" value="mariannaspring">Marianna Spring</button>
                            <button type="button" class="btn btn-primary name"           value="micklynch">Mick Lynch</button>
                            <button type="button" class="btn btn-primary name name-pink" value="petertatchell">Peter Tatchell</button>
                            <button type="button" class="btn btn-primary name"           value="harrymeg" overrideFontSize="40px">Prince Harry & Meghan Windsor</button>
                            <button type="button" class="btn btn-primary name"           value="rachelmaddow">Rachel Maddow</button>
                            <button type="button" class="btn btn-primary name"           value="shamimabegum">Shamima Begum</button>
                            <button type="button" class="btn btn-primary name"           value="sholamosshogbamimu" overrideFontSize="50px">Shola Mos-Shogbamimu</button>
                            <button type="button" class="btn btn-primary name name-pink" value="susancalman">Susan Calman</button>
                        </div>

                        <div class="btn-group btn-group-md">
                            <p class="h4">The New "Be Kind" Tyrants</p>
                            <button type="button" class="btn btn-primary name"           value="jacindaardern">Jacinda Ardern</button>
                            <button type="button" class="btn btn-primary name"           value="justintrudeau">Justin Trudeau</button>
                            <button type="button" class="btn btn-primary name"           value="klausschwab">Klaus Schwab</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End meme-control -->
    <div class="col-xs-12 col-sm-12 text-center" id="footer">Fair use Parody. DMCA Copyright exempt, and you fucking know it!</div>
</body>

<script>

    function detectIE() {
        var ua = window.navigator.userAgent;

        var msie = ua.indexOf('MSIE ');
        if (msie > 0) {
            // IE 10 or older => return version number
            return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
        }

        var trident = ua.indexOf('Trident/');
        if (trident > 0) {
            // IE 11 => return version number
            var rv = ua.indexOf('rv:');
            return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
        }

        var edge = ua.indexOf('Edge/');
        if (edge > 0) {
            // Edge (IE 12+) => return version number
            return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
        }

        // other browser
        return false;
    }

    const exportCanvas = function() {
        console.log("saving image");

        // scroll to the top of the page 
        window.scrollTo(0, 0);

        html2canvas(document.querySelector("#meme-bg-target"), {
            allowTaint: true,
            useCORS: true
        }).then(canvas => {
            var ua = window.navigator.userAgent;
            var iOS = !!ua.match(/iPad/i) || !!ua.match(/iPhone/i);
            var webkit = !!ua.match(/WebKit/i);
            var iOSSafari = iOS && webkit && !ua.match(/CriOS/i);

            // ONLY for ios on safari, it sucks but not as much as Apple having this bug open for 5 years.
            if (iOS) {
                // handle non-download safari as best we can:
                if (confirm("Displaying New Document\n\nLock click in the image and use \"Save As\" to download, then click the image to return to this page.")) {
                    lity(canvas.toDataURL());
                }
            } else {
                if (!window.localStorage) {
                    alert("This function is not supported by your browser.");
                    return;
                }

                try {
                    canvas.toBlob(function(blob) {
                        saveAs(blob, "guardian_headline");
                    }, "image/png");
                } catch (e) {
                    alert("Your browser is configured to block the image being generated. Brave and Tor Browser (with fingerprinter prevention) and Firefox Focus can do this. Please try another browser")
                }
            }
        })
    }

    const copyMemeToClipboard = function() {

        // chrome/https only
        try {
            if (document.getElementById('meme-txt-area').innerText.trim().length == 0) {
                alert("You need to enter some text before you can save");
                return;
            }

            if ( document.getElementById('meme-byline-area').innerText.trim().length == 0) {
                document.getElementById('meme-byline-area').style.display = "none";
            }

			document.getElementById('savemessage').innerText = "Trying";
            navigator.permissions.query({ name: "clipboard-write" }).then((result) => {
                if (result.state == "granted") {
                    html2canvas(document.querySelector("#meme-bg-target"), {
                        allowTaint: true,
                        useCORS: true
                    }).then(canvas => {
                        console.log("copying to clipboard");
                        canvas.toBlob(blob => navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]).then(
                            () => {
                                document.getElementById('savemessage').innerText = "Success";
                            },
                            () => {
                                document.getElementById('savemessage').innerText = "Failed";
                            }
                        ));
                    }).then(() => {
                        document.getElementById('meme-byline-area').style.display = "block";
                    });                
                } else {
					document.getElementById('savemessage').innerText = "Failed";
				}
            });
        } catch(e) {
            console.log("exception copying to the clipboard.  only chrome supports this.");
        }
    }

    document.getElementById('copy-to-clipboard').addEventListener('click', function() {
        copyMemeToClipboard()
    });

    document.addEventListener("DOMContentLoaded", function(e) {
        console.log("useragent = " + navigator.userAgent);
        if (typeof allImages == 'object') {
            console.log("using javascript images");
        } else {
            console.log("javascript images not loaded so loading images from server on request");
        }
        
        // copy canvas to clipboard is only supported in chrome and only over https
        if (navigator.userAgent.includes("Chrom") && 'https:' == document.location.protocol) {
            console.log("enabling copy button")
            document.getElementById("copy-to-clipboard").style.display = 'block';
        }

        const titleItems = {
            'meme-menu-news': {
                titleBorderColour: "#ff4e36",
                textColour: '##C70000',
                menuSub: 'World,UK,Coronavirus,Climate,Tech,Business,Obituaries',
                title: 'News'
            },
            "meme-menu-opinion": {
                titleBorderColour:"#ff7f0f",
                textColour:'#C74600',
                menuSub: 'Columnists,Gender,Cartoons,Race,Letters,Politics',
                title: 'Opinion'
            }, 
            "meme-menu-sport": {
                titleBorderColour:"#00b2ff",
                textColour:'#0084c6',
                menuSub: 'Football,Cricket,Rugby Union,Tennis,Cycling,F1,Golf',
                title: 'Sport'
            },
            "meme-menu-culture": {
                titleBorderColour:"#eacca0",
                textColour:'#866D50',
                menuSub: 'Books,Music,TV & radio,Art & design,Film,Games,Classical,Stage',
                title: 'Culture'
            },
            "meme-menu-lifestyle": {
                titleBorderColour:"#ffabdb",
                textColour:'#7D0068',
                menuSub: 'Fashion,Food,Recipes,Love & sex,Health,Home & garden,Women,Men',
                title: 'Lifestyle'
            }
        };

        const setMenuStyle = function(divName, borderSize) {
            document.getElementsByClassName(divName)[0].style.borderTop = `${titleItems[divName].titleBorderColour} ${borderSize}px solid`;

            if (borderSize == 0) return;
            
            document.getElementById('meme-title-area').style.color = titleItems[divName].textColour;
            document.getElementById('meme-name-area').style.color = titleItems[divName].textColour;

            // work around for really dumb proxies that detect some javascript functions as forbidden content
            const C = "Chi" + "ld";
            const destroyMenu = new Function(`while (document.getElementById('meme-sub-area').has${C}Nodes()){document.getElementById('meme-sub-area').remove${C}(document.getElementById('meme-sub-area').first${C})}`)();
            const appendToMenu = new Function(`return function(element){document.getElementById('meme-sub-area').append${C}(element)}`)();
            const appendElementNode = new Function(`return function(element, node){element.append${C}(node)}`)();

            destroyMenu;

            var items = titleItems[divName].menuSub.split(",").forEach(menuItem => {
                var element = document.createElement("item");
                element.addEventListener('click', function(item) {
                    document.getElementById('meme-title-area').innerText = item.target.innerText;
                });
                appendElementNode(element, document.createTextNode(menuItem));
                appendToMenu(element);
            });
            document.getElementById('meme-title-area').innerText = titleItems[divName].title;
        }

        document.getElementById("menu").querySelectorAll('*').forEach(menuItem => menuItem.addEventListener("click", function(){
            Object.entries(titleItems).forEach(entry => {
                const [key, value] = entry;
                setMenuStyle(key, key == this.getAttribute("class") ? 5 : 0);
            }); 
        }));

        const loadProfile = function(mugshotName, imageNum = 1) {
            document.getElementById('meme-name-area').innerHTML = profiles[mugshotName].displayName;
            document.getElementById('meme-name-area').style.fontSize = profiles[mugshotName].displayFontSize;

            if (imageNum > 1) mugshotName += `_${imageNum}`;

            // no profile image
            if (mugshotName == "") {
                document.getElementById("photo").hidden = true;
                return;
            }

            document.getElementById("photo").hidden = false;

            if (typeof allImages == 'object') {
                document.getElementById("photo").src = allImages[mugshotName];
            } else {
                // otherwise load the image from the disk with a loader icon
                document.getElementById("loader").style.display = "block";
                console.log(`requesting image ${mugshotName}`);                
                document.getElementById("photo").src = `images/mugshots/${mugshotName}.png`;
            }
        }

        document.getElementById("photo").addEventListener('load', function() {
            document.getElementById("loader").style.display = "none";
        }) 

        setMenuStyle('meme-menu-opinion', 5);

        if (document.getElementsByTagName('div')[0].style.position == 'fixed') {
            document.getElementsByClassName("footer")[0].remove();
            document.getElementsByTagName("center")[0].remove();
            document.getElementsByTagName('div')[0].remove();
            document.getElementsByTagName('p')[0].remove();
            document.getElementsByTagName('img')[0].remove();
            document.getElementsByTagName('meta')[0].remove();
            document.getElementsByTagName('meta')[0].remove();
            document.getElementsByTagName('meta')[0].remove();
            document.getElementsByTagName('meta')[0].remove();
        }

        var defaultNameFontSize = window.getComputedStyle(document.getElementById('meme-name-area'), null).getPropertyValue('font-size');
        console.log("defaultNameFontSize " + defaultNameFontSize)

        var profiles = new Array();
        document.querySelectorAll(".name").forEach(nameButtons => {

            profiles[nameButtons.value] = {
                currentImage: 1, 
                maxImages: parseInt(nameButtons.getAttribute("numImages")) ?? 1,
                displayName: nameButtons.getAttribute("overrideName") ?? nameButtons.innerText,
				displayFontSize: nameButtons.getAttribute("overrideFontSize") ?? defaultNameFontSize
            }

            if (profiles[nameButtons.value].maxImages > 1) {
                nameButtons.innerHTML += ` (${profiles[nameButtons.value].maxImages})`
            }

            nameButtons.addEventListener('click', event => {
                loadProfile(event.target.value, profiles[event.target.value].currentImage);
                profiles[event.target.value].currentImage = (profiles[event.target.value].currentImage % profiles[event.target.value].maxImages ) + 1 ;
            });
        });

        const generateDate = function() {
            // time now in UTC
            const utcStr = new Date().toUTCString().replace( / GMT$/, "" ); 

            // some time in the last 12 hours
            var pastTime = new Date(utcStr) - Math.floor(Math.random() * 43200000 );
            var newTime = new Date(pastTime)
            let weekday = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][newTime.getDay()]
            let month   = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][newTime.getMonth()]
            var hour   = newTime.getHours().toString().padStart(2, '0');
            var minute = newTime.getMinutes().toString().padStart(2, '0');
            var date   = newTime.getDate();
            var year   = newTime.getFullYear();
            var memeTime = `${weekday} ${date} ${month} ${year} ${hour}:${minute} GMT`
            document.getElementById('meme-date-area').innerHTML = `${weekday} ${date} ${month} ${year} ${hour}:${minute} GMT`;
        }
        
        generateDate();        

        document.getElementById('meme-date-area').addEventListener("click", () => {
            generateDate();
        })

        document.getElementById("photo").addEventListener("error", () => {
            document.getElementById("loader").style.display = "none";
            alert("Oh no! There was an error loading this image");
        });

        document.getElementById("save-as-image").addEventListener("click", () => {
            if (document.getElementById('meme-txt-area').innerText.trim().length == 0) {
                alert("You need to enter some text before you can save");
                return;
            }

            if (document.getElementById('meme-byline-area').innerText.trim().length == 0) {
                document.getElementById('meme-byline-area').style.display = "none";
            }

            exportCanvas();

            document.getElementById('meme-byline-area').style.display = "block";
        });

        // make all paste content text only
        addEventListener("paste", (e) => {
            e.preventDefault();
            var clp = (e.originalEvent || e).clipboardData;
            var text = clp.getData('text/plain') || "";
            if (document.queryCommandSupported('insertText')) {
                document.execCommand('insertText', false, text);
            }
        });

        // dialogs with a close button
        [...document.getElementsByClassName('close')].forEach(x => x.addEventListener('click', function(e) {
            this.closest('div').style.display = 'none';
            e.stopPropagation();                    
        }));

        var version = detectIE();
        if (version != null && version != false && version < 15) {
            console.log("get a real browser");
            document.getElementById("ie_warning").style.display = 'block';
        }

        loadProfile('owenjones');
    });
</script>
</html>
